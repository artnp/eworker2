<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏î‡∏π‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ - Eworker Store</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Noto+Sans+Thai:wght@300;400;600&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <style>
        :root {
            --primary: #8DEB2D;
            --bg: #0F1115;
            --surface: #1A1D24;
            --text: #FFFFFF;
            --text-muted: #A0AEC0;
            --border: rgba(255, 255, 255, 0.08);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Outfit', 'Noto Sans Thai', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.8;
        }

        .main-wrapper {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 24px;
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 40px;
        }

        @media (max-width: 1000px) {
            .main-wrapper {
                grid-template-columns: 1fr;
            }

            .payment-sidebar {
                position: static !important;
                width: 100% !important;
                margin-top: 40px;
            }
        }

        .container {
            width: 100%;
        }

        /* Guide Text Header */
        .guide-label {
            color: #FF6B00;
            font-size: 0.9rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
            display: block;
        }

        .article-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .category-badge {
            display: inline-block;
            padding: 6px 16px;
            background: rgba(141, 235, 45, 0.1);
            color: var(--primary);
            border-radius: 100px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 20px;
            text-transform: uppercase;
        }

        h1 {
            font-size: clamp(2rem, 5vw, 3rem);
            font-weight: 700;
            margin-bottom: 24px;
        }

        .meta-info {
            color: var(--text-muted);
            font-size: 1rem;
        }

        .divider {
            height: 1px;
            background: var(--border);
            margin: 20px 0;
        }

        .content-body {
            font-size: 1.1rem;
            color: #E2E8F0;

            /* Visual Frame for Info */
            background: var(--surface);
            border: 1px solid var(--border);
            border-left: 4px solid var(--primary);
            /* Accent line */
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        .content-body img {
            max-width: 100%;
            border-radius: 12px;
            margin: 30px 0;
            border: 1px solid var(--border);
        }

        .content-body iframe {
            width: 100%;
            aspect-ratio: 16/9;
            border-radius: 16px;
            margin: 30px 0 40px 0;

            /* Visual Frame for Video */
            border: 3px solid #FF6B00;
            box-shadow: 0 15px 50px rgba(255, 107, 0, 0.2);
            background: black;
        }

        .tags-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-top: 25px;
        }

        .tag-pill {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: rgba(141, 235, 45, 0.1);
            color: var(--primary);
            padding: 8px 16px;
            border-radius: 12px;
            font-size: 0.95rem;
            font-weight: 600;
            border: 1px solid rgba(141, 235, 45, 0.2);
            transition: all 0.3s;
        }

        .tag-pill:hover {
            transform: scale(1.05);
            background: rgba(141, 235, 45, 0.2);
        }

        /* Sidebar styles */
        .payment-sidebar {
            position: sticky;
            top: 40px;
            align-self: start;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 32px;
            padding: 24px;
            text-align: center;
        }

        .payment-sidebar h3 {
            color: var(--primary);
            margin-bottom: 20px;
        }

        #slip-canvas {
            width: 100%;
            border-radius: 16px;
            background: white;
        }

        .contact-btns {
            display: flex;
            flex-direction: row;
            /* Side by side */
            gap: 10px;
            margin-top: 10px;
        }

        .btn-chat {
            flex: 1;
            /* Equal width */
            padding: 8px 4px;
            border-radius: 12px;
            text-decoration: none;
            font-weight: 700;
            display: flex;
            flex-direction: column;
            /* Stack Content */
            align-items: center;
            justify-content: center;
            gap: 2px;
            font-size: 0.85rem;
            line-height: 1.25;
            white-space: normal;
            /* Allow wrapping if needed */
        }

        .btn-messenger {
            background: #0084FF;
            color: white;
        }

        .btn-line {
            background: #06C755;
            color: white;
        }

        .payment-sidebar.drag-active {
            border: 2px dashed var(--primary);
            background: rgba(141, 235, 45, 0.05);
            transform: scale(1.02);
            transition: all 0.2s ease;
        }

        .payment-info {
            margin-top: 15px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
        }

        /* Center sidebar on mobile */
        @media (max-width: 1000px) {
            .payment-sidebar {
                max-width: 450px;
                margin-left: auto;
                margin-right: auto;
            }
        }

        footer {
            margin-top: 100px;
            padding: 40px 0;
            border-top: 1px solid var(--border);
            text-align: center;
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .hidden {
            display: none !important;
        }

        /* Sticky Bottom Bar for Mobile */
        .mobile-sticky-bar {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: var(--surface);
            padding: 15px 20px;
            border-top: 1px solid var(--border);
            z-index: 100;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.5);
        }

        .sticky-price {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary);
        }

        .btn-sticky-buy {
            background: var(--primary);
            color: black;
            padding: 10px 24px;
            border-radius: 50px;
            font-weight: 700;
            text-decoration: none;
        }

        @media (max-width: 1000px) {
            .mobile-sticky-bar {
                display: flex;
            }

            body {
                padding-bottom: 80px;
            }

            /* Space for sticky bar */
        }

        /* FAQ Section */
        .faq-section {
            margin-top: 60px;
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.02);
        }

        .faq-header {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--primary);
        }

        .faq-item {
            margin-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            padding-bottom: 15px;
        }

        .faq-question {
            font-weight: 600;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .faq-answer {
            color: var(--text-muted);
            margin-top: 10px;
            display: none;
            font-size: 0.95rem;
        }

        .faq-item.active .faq-answer {
            display: block;
        }

        .faq-answer a {
            color: var(--primary);
            text-decoration: underline;
            font-weight: bold;
        }

        .faq-item.active .faq-question {
            color: white;
        }

        /* Verify & Download Button Styles */
        .btn-verify {
            background: orange;
            /* Neon Green */
            color: black;
            /* High contrast black text */
            border: 2px dashed #ffffff;
            width: 100%;
            padding: 14px;
            /* Larger click area */
            border-radius: 12px;
            font-weight: 800;
            /* Extra bold */
            font-size: 1.1rem;
            /* Larger font */
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
            box-shadow: 0 4px 15px rgba(141, 235, 45, 0.3);
            /* Green glow */
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        .btn-verify:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 0, 0.3);
            border-style: solid;
        }

        .btn-verify:disabled {
            background: var(--text-muted);
            cursor: not-allowed;
            transform: none !important;
        }

        .btn-download-now {
            background: var(--primary);
            color: black;
            display: block;
            width: 100%;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            font-weight: 800;
            text-decoration: none;
            font-size: 1.1rem;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(141, 235, 45, 0.4);
            }

            70% {
                box-shadow: 0 0 0 15px rgba(141, 235, 45, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(141, 235, 45, 0);
            }
        }
    </style>
</head>

<body>

    <div class="main-wrapper">
        <div class="container">
            <a href="index.html"
                style="color: var(--text-muted); text-decoration: none; margin-bottom: 30px; display: inline-block;">‚Üê
                ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô</a>
            <div id="article-view">
                <div class="article-header">
                    <span class="category-badge">‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</span>
                    <h1 id="title">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</h1>
                    <div class="tags-container" id="tags-list"></div>
                </div>
            </div>

            <div class="divider"></div>

            <div class="content-body" id="content">
                <!-- Content will load here -->
            </div>

            <div class="faq-section">
                <h2 class="faq-header">‚ùì ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏û‡∏ö‡∏ö‡πà‡∏≠‡∏¢ (FAQ)</h2>
                <div class="faq-item">
                    <div class="faq-question">‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏î‡πâ‡∏Ç‡∏≠‡∏á‡πÄ‡∏•‡∏¢‡πÑ‡∏´‡∏°? <span>‚ñº</span></div>
                    <div class="faq-answer">‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö!! <br><b><u>‡∏™‡πÅ‡∏Å‡∏ô‡∏à‡πà‡∏≤‡∏¢</u></b> > <b><u>‡∏Ñ‡∏∏‡∏ì‡∏û‡∏µ‡πà‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ</u></b>
                        >
                        ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏¢‡∏∑‡∏ô‡∏ö‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏•‡∏¥‡∏õ‡∏ß‡πà‡∏≤‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏´‡∏° ‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞<b><u>‡∏™‡πà‡∏á‡∏•‡∏¥‡πâ‡∏á‡∏Ñ‡πå‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</u></b>
                        <br><br>**‡∏´‡∏≤‡∏Å‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÉ‡∏´‡πâ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà LINE: <a href="https://line.me/ti/p/gqIluRmdJ_"
                            target="_blank">artap5321</a>
                        ‡∏´‡∏£‡∏∑‡∏≠ Facebook: <a href="https://m.me/61587141776821" target="_blank">E-Worker</a>
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏µ‡∏™‡∏≠‡∏ô‡πÑ‡∏´‡∏°? <span>‚ñº</span></div>
                    <div class="faq-answer">‡∏ú‡∏°‡πÑ‡∏î‡πâ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢‡∏™‡∏∏‡∏î ‡πÜ ‡πÑ‡∏°‡πà‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô
                        ‡∏´‡∏≤‡∏Å‡∏Ñ‡∏∏‡∏ì‡∏û‡∏µ‡πà‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏±‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏î‡πâ ‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏ú‡∏°‡∏à‡∏∞‡∏™‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡πÅ‡∏ö‡∏ö‡∏à‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏¢ ‡πÅ‡∏ö‡∏ö‡∏ï‡∏±‡∏ß‡∏ï‡πà‡∏≠‡∏ï‡∏±‡∏ß ‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏à‡πã‡∏á ‡πÜ
                        ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏±‡πä‡∏Å‡πÄ‡∏•‡∏¢</div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ï‡∏•‡∏≠‡∏î‡∏ä‡∏µ‡∏û‡πÑ‡∏´‡∏° ‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÄ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∞‡πÑ‡∏£‡∏≠‡∏µ‡∏Å‡πÑ‡∏´‡∏°? <span>‚ñº</span>
                    </div>
                    <div class="faq-answer">‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ï‡∏•‡∏≠‡∏î‡∏ä‡∏µ‡∏û‡πÑ‡∏õ‡πÄ‡∏•‡∏¢
                        ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡∏Å‡∏°‡∏±‡∏î‡πÉ‡∏î ‡πÜ ‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏´‡πà‡∏ß‡∏á‡∏Å‡∏±‡∏á‡∏ß‡∏•‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏•‡∏¢</div>
                </div>
            </div>
            <footer>
                <p>¬© <span id="year"></span>‡πÅ‡∏´‡∏•‡πà‡∏á‡∏£‡∏ß‡∏°‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡πÄ‡∏à‡πã‡∏á ‡πÜ ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏° ‚ú® ‡∏™‡∏á‡∏ß‡∏ô‡∏•‡∏¥‡∏Ç‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏£</p>
            </footer>
        </div>

        <aside class="payment-sidebar">
            <h3>üí≥ ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠</h3>


            <!-- 1. Process Guide (Restored) -->

            <!-- CSS for Step Badges -->
            <style>
                .step-wrapper {
                    position: relative;
                }

                .step-badge {
                    position: absolute;
                    top: -10px;
                    left: -10px;
                    width: 32px;
                    height: 32px;
                    background: #FF4444;
                    color: white;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-weight: 800;
                    font-size: 1.1rem;
                    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
                    z-index: 10;
                    border: 2px solid #1A1D24;
                    /* Match bg color for cutout effect */
                }
            </style>

            <!-- 1. QR Code (Step 1) -->
            <div class="step-wrapper" style="margin-bottom: 20px;">
                <div class="step-badge">1</div>
                <canvas id="slip-canvas"></canvas>


            </div>

            <!-- 2. Upload Slip (Step 2) -->
            <div id="verify-section" style="margin-top: 15px; border-top: 1px solid var(--border);">

                <div style="font-size: 0.8rem; color: #FFD700; margin-bottom: 15px; font-weight: 500;">
                    üìç ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 1 ‡∏ä‡∏°. ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô
                </div>
                <input type="file" id="slip-upload" accept="image/*" style="display: none;"
                    onchange="handleSlipUpload(this)">

                <div class="step-wrapper">
                    <div class="step-badge" style="z-index: 20;">2</div>
                    <button onclick="document.getElementById('slip-upload').click()" class="btn-verify">
                        üßæ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå)
                    </button>
                </div>
                <div id="verify-status" style="margin-top: 10px; font-size: 0.85rem; color: var(--text-muted);"></div>
            </div>

            <!-- 3. Download Section -->
            <div id="download-section" class="hidden" style="margin-top: 20px;">
                <div style="color: #4CAF50; margin-bottom: 10px; font-weight: bold; font-size: 1.1rem;">‚úÖ
                    ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</div>
                <a href="#" id="final-download-link" class="btn-download-now" target="_blank" rel="nofollow">
                    üì• ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                </a>
                <p style="font-size: 0.8rem; color: var(--text-muted); margin-top: 10px;">‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏≠‡∏∏‡∏î‡∏´‡∏ô‡∏∏‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö üôè</p>
            </div>

            <!-- 4. Contact Buttons (Side by Side & Nofollow) -->
            <div style="margin-top: 30px; border-top: 1px solid var(--border); padding-top: 20px;" id="manual-contact">
                <div style="font-size:0.85rem; color:var(--text-muted); margin-bottom:5px; text-align: left;">‚ö†Ô∏è
                    ‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤ / ‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°:</div>
                <div class="contact-btns" style="margin-top: 0;">
                    <a href="https://line.me/ti/p/gqIluRmdJ_" target="_blank" class="btn-chat btn-line" rel="nofollow">
                        <span>üü¢ LINE</span>
                        <span style="font-size: 0.75rem; font-weight: 400; opacity: 0.95;">artap5321</span>
                    </a>
                    <a href="https://m.me/61587141776821" target="_blank" class="btn-chat btn-messenger" rel="nofollow">
                        <span>üîµ Facebook</span>
                        <span style="font-size: 0.75rem; font-weight: 400; opacity: 0.95;">E-Worker</span>
                    </a>
                </div>
            </div>

        </aside>
    </div>



    <!-- Hidden QR Container (For Generation) -->
    <div id="hidden-qr-container" style="display:none;"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script>
        document.getElementById('year').textContent = new Date().getFullYear();

        // Global variables
        let currentProductData = null;
        let pIcon = new Image();
        let bankIcon = new Image();

        function preloadIcons() {
            bankIcon.src = 'https://cdn-icons-png.flaticon.com/512/2534/2534168.png'; // Generic bank icon (or TTB)
        }

        // 1. PromptPay Payload Generator (Original Working Logic)
        function crc16(data) {
            let crc = 0xFFFF;
            for (let i = 0; i < data.length; i++) {
                let x = ((crc >> 8) ^ data.charCodeAt(i)) & 0xFF;
                x ^= x >> 4;
                crc = ((crc << 8) ^ (x << 12) ^ (x << 5) ^ x) & 0xFFFF;
            }
            return crc.toString(16).toUpperCase().padStart(4, '0');
        }

        function formatTag(id, value) { return id + value.length.toString().padStart(2, '0') + value; }

        function generatePromptPayPayload(id, amount = 0) {
            let cleanId = id.replace(/[^0-9]/g, '');
            // Correct logic: 08x -> 00668x
            let target = cleanId.startsWith('0') && cleanId.length === 10 ? "0066" + cleanId.substring(1) : cleanId;
            let accType = (cleanId.length >= 13 && !cleanId.startsWith('0')) ? '02' : '01';

            const subChunk = formatTag('00', 'A000000677010111') + formatTag(accType, target);
            // 01 11 means Static (Reuseable), 12 means Dynamic. User snippet used 11.
            let p = formatTag('00', '01') + formatTag('01', '11') + formatTag('29', subChunk) + formatTag('53', '764') + formatTag('58', 'TH');

            if (amount > 0) p += formatTag('54', parseFloat(amount).toFixed(2));
            p += '6304' + crc16(p + '6304');
            return p;
        }

        // 2. Draw Premium Slip
        function createPremiumSlip(qrCanvas, id, amount) {
            const canvas = document.getElementById('slip-canvas');
            const ctx = canvas.getContext('2d');
            const W = 400, H = 580;
            canvas.width = W; canvas.height = H;

            // Background
            ctx.fillStyle = '#FFFFFF';
            ctx.fillRect(0, 0, W, H);

            // Header (Thai QR Payment Blue)
            const blue = '#1A3C6E';
            ctx.fillStyle = blue;
            ctx.fillRect(0, 0, W, 100);

            ctx.fillStyle = '#FFFFFF';
            if (pIcon.complete) {
                // Draw PromptPay Logo (White BG container)
                ctx.drawImage(pIcon, 20, 20, 150, 60);
            }

            // Thai QR Payment Text & Steps
            ctx.fillStyle = '#FFFFFF';
            ctx.textAlign = 'center';

            // Link 1: Header
            ctx.font = 'bold 24px sans-serif';
            ctx.fillText('‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏¢‡πå', W / 2, 40);

            // Line 2: Process Guide
            ctx.font = '18px sans-serif';
            ctx.fillText('1.‡∏™‡πÅ‡∏Å‡∏ô‡∏à‡πà‡∏≤‡∏¢ ‚ûú 2.‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ ‚ûú 3.‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå', W / 2, 75);

            // Body
            const qrSize = 250;
            const qrX = (W - qrSize) / 2;
            const qrY = 130;

            if (qrCanvas) {
                ctx.drawImage(qrCanvas, qrX, qrY, qrSize, qrSize);
            }

            // Info
            ctx.fillStyle = '#333333';
            ctx.font = 'bold 28px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('‡∏¢‡∏≠‡∏î‡∏ä‡∏≥‡∏£‡∏∞: ' + parseFloat(amount).toLocaleString('en-US') + ' ‡∏ö‡∏≤‡∏ó', W / 2, 450);

            ctx.fillStyle = '#666666';
            ctx.font = '16px sans-serif';
            ctx.fillText('‡∏™‡πÅ‡∏Å‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏≠‡∏õ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£', W / 2, 490);

            // Button (Visual only - User clicks the whole canvas or the external button)
            // But user wants it IN the slip.
            const btnW = 200, btnH = 40;
            const btnX = (W - btnW) / 2, btnY = 510;

            // Button Shadow
            ctx.fillStyle = 'rgba(0,0,0,0.1)';
            ctx.beginPath();
            ctx.roundRect(btnX + 2, btnY + 2, btnW, btnH, 20);
            ctx.fill();

            // Button BG
            ctx.fillStyle = '#f8f9fa';
            ctx.beginPath();
            ctx.roundRect(btnX, btnY, btnW, btnH, 20);
            ctx.fill();

            // Button Border
            ctx.strokeStyle = '#dee2e6';
            ctx.lineWidth = 1;
            ctx.stroke();

            // Button Text
            ctx.fillStyle = '#333';
            ctx.font = 'bold 16px sans-serif';
            ctx.fillText('‚¨áÔ∏è ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û', W / 2, btnY + 26);

            // Add click listener to canvas for this button area
            // Note: This adds a listener every time createPremiumSlip results. Ideally should be once.
            // But since this function runs once per load usually, it's okay.
            canvas.style.cursor = 'pointer';
            canvas.onclick = function (e) {
                downloadQR();
            };


        }

        async function loadContent() {
            const urlParams = new URLSearchParams(window.location.search);
            const id = urlParams.get('id');
            if (!id) { window.location.href = 'index.html'; return; }

            try {
                const res = await fetch(`data/content/${id}.json`);
                if (!res.ok) throw new Error('Not found');
                const data = await res.json();
                currentProductData = data;

                document.title = data.title + " - Eworker Store";
                document.getElementById('title').textContent = data.title;
                document.getElementById('content').innerHTML = data.content;

                // Render Tags
                const tagsContainer = document.getElementById('tags-list');
                const icons = {
                    'HTML': 'üåê', 'PHP': 'üêò', 'NODE.JS': 'üü¢', 'Addon Chrome': 'üß©',
                    'Python': 'üêç', 'Javascript': 'üìú', 'Playwright': 'üé≠', 'AI': 'ü§ñ'
                };
                if (data.tags && data.tags.length > 0) {
                    tagsContainer.style.alignItems = 'center';
                    tagsContainer.innerHTML = '<span style="color: var(--text-muted); font-size: 0.9rem; margin-right: 12px;">‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏©‡∏≤‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô:</span>' +
                        data.tags.map(t => `<span class="tag-pill">${icons[t] || ''} ${t}</span>`).join('');
                }

                // Generate QR
                preloadIcons();
                const pId = "0988573074"; // PromptPay Number
                const amount = parseFloat(data.price);
                const payload = generatePromptPayPayload(pId, amount);
                const qrContainer = document.getElementById('hidden-qr-container');
                qrContainer.innerHTML = '';

                new QRCode(qrContainer, {
                    text: payload,
                    width: 250,
                    height: 250,
                    correctLevel: QRCode.CorrectLevel.H
                });

                // Wait for image render
                setTimeout(() => {
                    const qrCanvas = qrContainer.querySelector('canvas');
                    if (qrCanvas) {
                        createPremiumSlip(qrCanvas, id, amount);
                    }
                }, 500);

            } catch (e) {
                document.getElementById('article-view').innerHTML = "<h1>‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ</h1><p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>";
            }
        }

        // FAQ Toggle
        document.querySelectorAll('.faq-question').forEach(item => {
            item.addEventListener('click', () => {
                item.parentElement.classList.toggle('active');
            });
        });

        loadContent();

        // Real Slip Verification
        // Helper: Convert File to Base64
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result.split(',')[1]); // Remove "data:image/xxx;base64,"
                reader.onerror = error => reject(error);
            });
        }

        // Real Slip Verification (via Google Apps Script)
        async function handleSlipUpload(input) {
            // REPLACE THIS WITH YOUR DEPLOYED GOOGLE APPS SCRIPT URL!
            const GAS_ENDPOINT_URL = 'https://script.google.com/macros/s/AKfycbw9_ZgNf0pzFbLwXP_gx7ZAvrEJwdXbVEWr1_Y23M4waokRsw25b98UHJxxhkRMo7QU8w/exec';

            if (!input.files || !input.files[0]) return;
            if (!currentProductData) { alert('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä'); return; }

            const file = input.files[0];
            const statusDiv = document.getElementById('verify-status');
            const btn = document.querySelector('.btn-verify');

            // 1. UI Loading
            btn.disabled = true;
            btn.innerHTML = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...';
            statusDiv.innerHTML = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡πá‡∏Ñ‡∏¢‡∏≠‡∏î‡∏Å‡∏±‡∏ö‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£';
            statusDiv.style.color = '#FFA500';

            try {
                // 2. Convert to Base64
                const base64File = await fileToBase64(file);

                // 3. Prepare Payload (JSON)
                const payload = {
                    file: base64File,
                    price: currentProductData.price,
                    productId: new URLSearchParams(window.location.search).get('id')
                };

                // 4. Call Google Apps Script (Using 'no-cors' trick not standard here, standard POST is fine if GAS handles CORS)
                // Note: Apps Script must handle OPTIONS or use type text/plain to avoid CORS preflight issues sometimes.
                // We typically use text/plain content-type to bypass complex CORS preflight on simple requests.

                const response = await fetch(GAS_ENDPOINT_URL, {
                    method: 'POST',
                    body: JSON.stringify(payload)
                    // No headers needed for simple text/plain POST to GAS
                });

                const result = await response.json();

                if (result.success) {
                    // Success!
                    btn.style.display = 'none'; // Hide button
                    document.getElementById('manual-contact').classList.add('hidden'); // Hide contact buttons
                    document.getElementById('verify-section').style.display = 'none'; // Hide upload section

                    const downloadSection = document.getElementById('download-section');
                    downloadSection.classList.remove('hidden');

                    const dlLink = document.getElementById('final-download-link');
                    dlLink.href = result.link; // Link from GAS

                    if (result.link === '#' || !result.link) {
                        dlLink.textContent = "‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô (‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤)";
                        dlLink.style.background = "#555";
                    }

                    statusDiv.innerHTML = '';
                    alert('‚úÖ ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏±‡∏ö! ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
                } else {
                    // Failed
                    throw new Error(result.message || 'Verification failed');
                }

            } catch (err) {
                console.error(err);
                btn.disabled = false;
                btn.innerHTML = 'üßæ ‡∏•‡∏≠‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà';
                statusDiv.innerHTML = '‚ùå ' + (err.message || "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠");
                statusDiv.style.color = '#ff4444';
            }
        }

        // --- Drag & Drop Feature ---
        const dropZone = document.querySelector('.payment-sidebar');

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            dropZone.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, unhighlight, false);
        });

        function highlight(e) {
            dropZone.classList.add('drag-active');
        }

        function unhighlight(e) {
            dropZone.classList.remove('drag-active');
        }

        dropZone.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            if (files.length > 0) {
                // Manually trigger the upload function
                const mockInput = { files: files };
                handleSlipUpload(mockInput);
            }
        }

        function downloadQR() {
            const canvas = document.getElementById('slip-canvas');
            const link = document.createElement('a');
            link.download = 'payment-qr.png';
            link.href = canvas.toDataURL();
            link.click();
        }
    </script>
</body>

</html>